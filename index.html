<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://cgchcwqtevbybjxibamz.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNnY2hjd3F0ZXZieWJqeGliYW16Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEyMzY4ODksImV4cCI6MjA3NjgxMjg4OX0.2s1i2-cWPsjdnxcK0eijKJESp-AY08MNSWRIQSeLwKs";
  const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  function getHashParams() {
    const hash = window.location.hash.startsWith("#") ? window.location.hash.slice(1) : "";
    return new URLSearchParams(hash);
  }

  async function initSessionFromHash() {
    const p = getHashParams();
    const access_token = p.get("access_token");
    const refresh_token = p.get("refresh_token");

    if (!access_token || !refresh_token) {
      throw new Error("Missing session tokens in link. Request a new reset email.");
    }

    const { error } = await sb.auth.setSession({ access_token, refresh_token });
    if (error) throw error;
  }

  // Call initSessionFromHash() on load, then allow updateUser({ password })
</script>
